<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>JUMBLE</title>
<link href="/jumble.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="/jquery-1.12.2.min.js"></script>
<script type="text/javascript">
	var user = undefined;
	var message = undefined;
	LOCAL

	(function activity() {
		$.getJSON('/game/' + local.gid)
		.done(function(data) {
                status_html = '<td align=center colspan=3>';
                status_html += '<table>';
			for (i = 0; i < data.users.length; i++) {
                status_html += '<tr><td>';
                status_html += 'Player <b>' + data.users[i].name + '</b> working on puzzle <i>' + data.users[i].puzzle + '</i>';
                status_html += '</td></tr>';
            }
            status_html += '</table></td>';
			document.getElementById('game.status').innerHTML = status_html;

			document.getElementById('game.time').innerHTML = "Time remaining: " + data.timer;
			setTimeout(activity, 1000);
		})
		.fail(function() {
			document.getElementById('game.status').innerHTML = "<p>Error</p>";
		})
		.always(function() {
		});
	})();


	(function puzzle() {
		$.getJSON('/game/' + local.gid + '/puzzle/' + local.pid)
		.done(function(data) {
			scramble_html = '';
			for (i = 0; i < data.scramble.length; i++) {
				scramble_html += '<section>';
				scramble_html += data.scramble.charAt(i);
				scramble_html += '</section>';
			}
			document.getElementById('game.scramble').innerHTML = scramble_html;

            if (!data.solved) {
                document.getElementById("game.guess").style.visibility = "visible";
            } else {
                document.getElementById("game.guess").style.visibility = "hidden";
            }

			if (data.message) {
                state_html = '<td> </td><td align=center><h3>';
                state_html += data.message;
                state_html += '</h3></td>';
				document.getElementById('puzzle.state').innerHTML = state_html;
            }
			setTimeout(puzzle, 1000);
		})
		.fail(function() {
			document.getElementById('game.scramble').innerHTML = "<font color=red>Error Loading Puzzle</font>";
		})
		.always(function() {
		}) ;
	})();

</script>
</head>

<body>


        <center>
<table border=0> 

	<!-- timer -->

    <div id=wrapper>
    <tr>
      <td> </td>
      <td align=center id="game.time">Time remaining: Loading ...</td>
      <td></td>
    </tr>
    </div>
    
    <!-- spacing between timer and previous and next buttons -->
    <div id=wrapper>
    <tr >
      <td height=30></td>
    </tr>
    </div>

	<!-- previous and next buttons -->

    <div id=wrapper>
    <tr>
      <td align=center id="prev_puzzle">
        <script type="text/javascript">
	  html = '<form action="/game/'
	  html += local.gid
	  html += '/user/'
	  html += local.uid
	  html += '" method="post">';
	  document.write(html);
        </script>
        <input type="hidden" name="puzzle" value="prev">
        <input type="submit" value="previous">
        </form>
      </td>
      <td> </td>
      <td align=center id="next_puzzle">
        <script type="text/javascript">
	  html = '<form action="/game/'
	  html += local.gid
	  html += '/user/'
	  html += local.uid
	  html += '" method="post">';
	  document.write(html);
        </script>
        <input type="hidden" name="puzzle" value="next">
        <input type="submit" value="next">
        </form>

      </td>
    </tr>
    </div>

    <!-- spacing between buttons and jumble -->
    <div id=wrapper>
    <tr >
      <td height=20></td>
    </tr>
    </div>
    
	<!-- jumble display -->
	<div id=wrapper>
    <tr>
    	<script type="text/javascript">
        	html = "<td align=center><h3>Puzzle ";
		html += local.pid;
		html += ": </h3></td>";
		document.write(html)
	</script>
      	<td align=center id="game.scramble">
                Loading ...
	    </td>
        <td></td>
    </tr>
    
    </div>
    
    <!-- spacing between puzzle and solution input -->
    <div id=wrapper>
    <tr >
      <td height=10></td>
    </tr>
    </div>
    
    <!-- solution display -->
    <div id=wrapper>
    <tr id="game.guess">
      <td align=center valign=top><h3>Your Guess:</h3></td>
      <td align=center valign=top>
      <script type="text/javascript">
        document.write('<form action="/game/' + local.gid + '/puzzle/' + local.pid + '" method="post">');
        guess_html = '';
        for (i = 0; i < local.puzzle_len; i++) {
                guess_html += '<input type="text"';
                for (j = 0; j < local.puzzle_indices.length; j++) {
                        if (i == local.puzzle_indices[j]) {
                                guess_html += ' id="highlight"';
                        }
                }
                guess_html += ' name="l' + i + '"';
                guess_html += ' maxlength=1 size=1>';
        }
        document.write(guess_html);
        document.write('<input type="hidden" name="uid" value="' + local.uid + '">');
      </script>
      <br><br>
      <input type="submit" value="Submit">
      </form>
      </td>
    </tr>
    <tr id="puzzle.state">
    </tr>
    <br>
    </div>

    <!-- spacing between guess and status -->
    <div id=wrapper>
    <tr >
      <td height=40></td>
    </tr>
    </div>

    <!-- status display -->
    <div id=wrapper>
    <tr id="game.status">
    </tr>
    </div>
    
</table>
</center>

<script type="text/javascript">
    if (local.previous != null) {
        document.getElementById("prev_puzzle").style.visibility = "visible";
    } else {
        document.getElementById("prev_puzzle").style.visibility = "hidden";
    }
    if (local.next) {
        document.getElementById("next_puzzle").style.visibility = "visible";
    } else {
        document.getElementById("next_puzzle").style.visibility = "hidden";
    }
</script>


</body>
</html>
